# 자주쓰는 도커 명령어

docker build시 Dockerfile을 읽는다. 간단한 Node 기반 서버를 쓴다고 가정하면 기본 Dockerfile은 아래와 같다. 

## Dockerfile
```shell
FROM node:10

WORKDIR /usr/src/app

COPY package.json ./

RUN npm install

COPY ./ ./

CMD ["node", "index.js"]
```

1. FROM : base image는 도커 허브로부터 가져온다. node:10
2. WORKDIR :COPY할 파일들의 working directory를 명시한다. 
3. COPY : package.json을 도커 컨테이너에 복사한다.
4. RUN : npm install을 통해 임시 컨테이너 위에, 추가적인 파일들을 추가하여 새로운 컨테이너를 생성한다.
5. CMD : 생성한 컨테이너에서 ```node index.js``` 명령어를 실행한다.
6. ** COPY를 2번한 이유는 최적화를 위해서다. package.json을 먼저 copy해서 의존성이 추가되지 않았다면 ```RUN npm install```시에 캐싱된 node_modules를 사용한다. 그 후 ```COPY ./ ./```로 변경된 파일들을 카피하고 실행한다. 

## Build

- 기본 명령어
  - docker build ./
- docker build -t 2donny/nodejs ./
  - -t : tag를 통해 컨테이너 이름을 붙인다. 


## Run
- 기본 명령어
  - docker run 이미지 이름
- docker run -it 2donny/nodejs sh
  - -it: interative terminal로서 터미널을 계속 사용할 수 있다.
- docker run -p 4000:8080 2donny/nodejs
  - -d : detach한다. 백그라운드로 컨테이너를 실행하고, 터미널을 빠져나간다.
  - -p : 로컬포트:컨테이너포트 
    - 컨테이너 포트와 server.js 내에 app.listen(PORT)의 PORT와 같아야한다.


## Volume